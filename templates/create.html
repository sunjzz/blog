{% extends 'base.html' %}
{% load staticfiles %}
{% block head_js %}
    <script type="text/javascript" src="{% static "ckeditor/ckeditor-init.js" %}"></script>
    <script type="text/javascript" src="{% static "ckeditor/ckeditor/ckeditor.js" %}"></script>
{% endblock %}
{% block custom %}
    <div class="fh5co-entry padding">
        <form action="{% url 'article:article_create' %}">
            <div>
                <label>文章标题</label>
                <input type="text" name="title" value="" id="js-pl-1">
            </div>
            <div>
                <label>文章描述</label>
                <input type="text" name="title" value="" id="js-pl-2">
            </div>
            <div>
                <label>文章分类</label>
                <select id="js-pl-3">
                    {% for item in article_category %}
                        <option value="{{ item }}">{{ item }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>文章标签</label>
                <select id="js-pl-4">
                    {% for item in article_tag %}
                        <option value="{{ item }}">{{ item }}</option>
                    {% endfor %}
                </select>
            </div>
{#            <textarea name="editor1" id="js-pl-textarea"></textarea>#}
{#            <script>#}
{#                CKEDITOR.replace( 'editor1' );#}
{#            </script>#}
        <div>
            <input type="submit" value="保存" id="js-pl-submit">
        </div>
        </form>
    </div>
{% endblock %}
{% block custom_js %}
<script type="text/javascript">
        //添加文章
        $('#js-pl-submit').on('click', function(){
            var article_title = $("#js-pl-1").val();
            var article_desc = $("#js-pl-2").val();
            var article_category = $("#js-pl-3").val();
            var article_tag = $("#js-pl-4").val();
            var article_content =  CKEDITOR.instances.editor1
{#            var article_content =  CKEDITOR.instances.editor1.getData();#}
{#            var article_content = $("#js-pl-textarea").val();#}
            console.log('test');
            console.log(article_content);
            if(article_content == ""){
                alert("文章内容不能为空");
                return
            }
            $.ajax({
                cache: false,
                type: "POST",
                url:"{% url 'article:article_create' %}",
                data:{'article_title':article_title, 'article_desc':article_desc,
                    'article_category': article_category, 'article_tag': article_tag,
                    'article_content': article_content},
                async: true,
                beforeSend:function(xhr, settings){
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                },
                success: function(data) {
{#                    if(data.status == 'fail'){#}
{#                        if(data.msg == '用户未登录'){#}
{#                            window.location.href="/login/";#}
{#                        }else{#}
{#                            alert(data.msg)#}
{#                        }#}
{##}
{#                    }else if(data.status == 'success'){#}
{#                        window.location.reload();//刷新当前页面.#}
{#                    }#}
                        alert(data.msg)
                }
            });
        });
    </script>
{% endblock %}